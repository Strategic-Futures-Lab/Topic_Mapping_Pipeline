# Topic Mapping Pipeline - 2020 [![CC BY-NC 4.0][cc-by-nc-shield]][cc-by-nc]
# Topic Clustering Module

The Topic Clustering module is the eighth module of the Topic Mapping pipeline, and third in the `P4_Analysis` package.
It primarily produces a hierarchical clustering for a group of topics, in the form of a linkage table. If sub topics
are given it will first generate groups of sub topics according to their assignment to main topics: i.e. if two or more
sub topics were assigned to the same main topic, a group containing these sub topics will be created for that main
topic. Note that if sub topics were assigned to more than one main topic, they will be duplicated and present in
multiple groups.

The linkage tables (and groups) are directly saved in ***Topic JSON file(s)***.

The use of this module is necessary for the mapping of topics.

The Topic Clustering module is contained in the `P4_Analysis.TopicClustering` package, in the `TopicClustering.java`
class.

## Specifications

The Topic Clustering module entry in the project file should have the following structure:
```json5
{...
  "clusterTopics": {
    "mainTopics": "path",
    "subTopics": "path",
    "linkageMethod": "max",
    "clusters": 2,
    "mainOutput": "path",
    "subOutput": "path"
  },
...}
``` 

Where:
- `mainTopics` is the path to the topics JSON file generated by the simple
[Topic Modelling module](ModelModule.md), or to the main topics JSON file generated by the
[Hierarchical Topic Modelling module](ModelModule.md), or the main topic JSON file generated by the [Topic 
Distribution module](TopicDistributionModule.md) if ran;
- `subTopics` is the path to the sub topics JSON file generated by the
[Hierarchical Topic Modelling module](ModelModule.md), or to the sub topics JSON file generated by the [Topic
Distribution module](TopicDistributionModule.md), it is optional and won't group/cluster sub topics if not specified;
- `linkageMethod` is the linkage method to use when building the hierarchical clusters, it is optional and defaults 
to `avg`, currently three methods are available: complete with `max`, single with `min`, and unweighted average
(UPGMA) with `avg`;
- `clusters` is the number of cluster into which the main topics should be spread, sub topics are not affected by this
value, it is optional and will defaults to `1`;
- `mainOutput` is the path to the main topics JSON file to output;
- `subOutput` is the path to the sub topics JSON file to output, it is only necessary when `subTopics` is specified.

Note that sub-topics won't be grouped if the meta-parameter `modelType` is set to `simple`.

## Output

Used on the main topics, the Topic Clustering module generates and add the linkage table data to the main
topic JSON file:
```json5
{...
  "linkageTable": [
    {
      "node1": 2,
      "node2": 9,
      "distance": 0.6991
    },...
  ]
}
```
`node1` and `node2` both points to either a topic index in the list of topics (if the value is inferior to the number
of topics), or to a node index in the linkage table itself (if the value is superior or equal to the number of topics).
`distance` is the distance at which the two nodes join in the hierarchy.

It also adds a `clusterId` field to each main topic with a string identifier value.

Used on the sub topics, the Topic Clustering module reorganises the list of topics into a list of sub topic groups:
```json5
{...
  "subTopicGroups": [
    {
      "mainTopicId": "11",
      "topics": [
        {
          "topicId": "4",
          "topicIndex": 4,
          "groupTopicId": "0",
          "groupTopicIndex": 0,
          "topDocs": [ ... ],
          "topWords": [ ... ],
          "mainTopicIds": [ "11", ... ],
          "distributions": [ ... ],
          "totals": [ ... ]
        }, ...
      ],
      "similarities": [ [ ... ], ... ],
      "linkageTable": [ ... ]
    }, ...
  ]
}
```
Each sub topic group contains:
- `mainTopicId` the id of the main topic to which these sub topics were assigned;
- `topics` the list of sub topics in that group, note the addition of two fields:
    - `groupTopicId` which identifies this topic in the context of that group;
    - `groupTopicIndex` to point to that topic in the context of that group, e.g. in the similarity matrix or the
    linkage table;
- `similarities` the topic to topic similarity matrix for topics of that group;
- `linkageTable` with the same structure as presented above, for topics of that group.

---

[< Previous](TopicDistributionModule.md) | [Index](index.md) | [Next >](TopicMapping.md)

---
This work is licensed under a [Creative Commons Attribution 4.0 International
License][cc-by-nc].

[![CC BY-NC 4.0][cc-by-nc-image]][cc-by-nc]

[cc-by-nc]: http://creativecommons.org/licenses/by-nc/4.0/
[cc-by-nc-image]: https://i.creativecommons.org/l/by-nc/4.0/88x31.png
[cc-by-nc-shield]: https://img.shields.io/badge/License-CC%20BY--NC%204.0-lightgrey.svg
