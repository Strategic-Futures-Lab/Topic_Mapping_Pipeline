# Topic Mapping Pipeline - 2020 [![CC BY-NC 4.0][cc-by-nc-shield]][cc-by-nc]
# Infer Documents Module

The Infer Documents module is the fifth module of the Topic Mapping Pipeline.It generates the topic distribution of new 
documents from an existing model. For that, it reads a model previously built by the 
[Topic Model module](ModelModule.md) and new documents lemmatised by the [Lemmatise Module](LemmatiseModule.md).
The new distributions are saved in a ***Document JSON file*** and optionally in ***Document CSV file(s)***.
 
The Infer Documents module is contained in the `P3_TopicModelling` package.

## Specifications

The Infer Documents module entry in the project file should have the following structure:
```json5
{...
  "inferDocuments": {
    "mainModel": "path",
    "subModel": "path",
    "lemmas": "path",
    "iterations": 1000,
    "docFields": ["key", ... ],
    "documentOutput": "path",
    "mainOutputCSV": "path",
    "subOutputCSV": "path",
    "outputCSV": "path",
    "numWordId": 3
  },
...}
```
Where:
- `mainModel` is the path to the serialised model file (generated by the simple [Topic Modelling module](ModelModule.md)),
or to the serialised main model file (generated by the [Hierarchical Topic Modelling module](ModelModule.md));
- `subModel` is the path to the serialised sub model file (generated by the
[Hierarchical Topic Modelling module](ModelModule.md)), it is optional and the module will not infer documents 
from the sub model if the parameter is not specified;
- `lemmas` is the path to the lemmatised documents JSON file (generated by the [Lemmatise module](LemmatiseModule.md));
- `iterations` lets you defined the number of iteration the inference process must go through, it is optional and will
default to 100;
- `docFields` specifies which key from the `docData` entry of documents should be kept when saving the data, note 
that this list is overwritten by the meta-parameter `docFields`;
- `documentOutput` is the path to the document JSON file exported in which the lemmatised documents are listed with
their inferred topic distribution;
- `mainOutputCSV` is the path to the document CSV file listing documents and their weights in the main topics, it
is optional, and defaults to `""` meaning that no CSV should be created;
- `subOutputCSV` is the path to the document CSV file listing documents and their weights in the sub topics, it is
optional and defaults to `""` meaning that no CSV should be created, it is only used if sub topics are exported;
- `outputCSV` is the path to the document CSV file listing documents and their weights in both the main and sub topics
(each topic is annotated accordingly), it is optional and defaults to `""` meaning that no CSV should be created;
- `numWordId` is the number of labels to use to identify a topic in the document CSV files.

Note that topic distributions will not be inferred from the sub model if the meta-parameter `modelType` is set to
`simple`.

## Output

The Infer Document module can output multiple files.

First, the document JSON file, which follows a similar structure to the document file generated by the
[Topic Model Modules](ModelModule.md):
```json5
{
  "metadata":{...
    "nTopicsMain":20,
    "nTopicsSub":30
  },
  "documents":[
    {
      "docId":"0",
      "docIndex":0,
      "numLemmas":107,
      "docData":{"key": "value", ...},
      "mainTopicDistribution":[ ... ],
      "subTopicDistribution":[ ... ]
    },{
      "docId": "1",
      "docIndex": 1,
      "removed": true,
      "removeReason":"Too short",
      "numLemmas": 2,
      "docData": {"key": "value2", ...}
    },...
  ]
}
```
As with the [Topic Model Modules](ModelModule.md), this file builds on top of the lemma JSON file. To the `metadata`, 
it adds:
- the number of topics in the main model, `nTopicsMain`;
- the number of topics in the sub model, `nTopicsSub`, if a sub model is also used for inference.

To the `documents` it adds (if the documents was not removed):
- `mainTopicDistribution` the list of topic weights from the main model;
- `subTopicDistribution` the list of topic weights from the sub model, if used for inference.

Note that the `docData` will also be adjusted to fit with the `docFields` specification.

Then, the document CSV file(s), if set in the specifications, following this structure:
```csv
"_docId", "key1",   "key2",   ..., "_wordCount", "_includedInModel", "_reasonForRemoval", "_mainTopic_topic-1-labels", "_mainTopic_topic-2-labels", ...
"0",      "value1", "value2", ..., "107",        "true",             "",                  "0.0197",                    "0.0099",                    ...
```
Each row represents a document, with `key1`, `key2`, etc. being the keys set in `docFields`. The CSV also includes the 
`wordCount` per document, whether the document was included in the model or not, and, if not, the reason for its 
removal (e.g. `"Too short"`). Finally, for each topic, identified by a list of their top labels, there is the weight of
that topic in the document. Each topic identifier is also annotated with either `_mainTopic_` or `_subTopic_` to help
identify which model they are from. 

---

[< Previous](ExportModule.md) | [Index](index.md) | [Next >](LabelIndexModule.md)

---
This work is licensed under a [Creative Commons Attribution 4.0 International
License][cc-by-nc].

[![CC BY-NC 4.0][cc-by-nc-image]][cc-by-nc]

[cc-by-nc]: http://creativecommons.org/licenses/by-nc/4.0/
[cc-by-nc-image]: https://i.creativecommons.org/l/by-nc/4.0/88x31.png
[cc-by-nc-shield]: https://img.shields.io/badge/License-CC%20BY--NC%204.0-lightgrey.svg
