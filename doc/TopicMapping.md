# Topic Mapping Pipeline - 2020 [![CC BY-NC 4.0][cc-by-nc-shield]][cc-by-nc]
# Topic Mapping Modules

The Topic Mapping modules come eighth in the list of modules of the Topic Mapping pipeline. It uses the data
generated by the [Topic Clustering module](TopicClusteringModule.md) to create mapping information for the topics,
including position information and border details. With main topics it creates one main map. If sub topics are
provided to be mapped, it will create a set of maps, one per sub topic groups (as generated in the 
[Topic Clustering module](TopicClusteringModule.md)).

The mapping information are saved in ***Map JSON file(s)***.

The Topic Mapping modules are contained in the `P5_TopicMapping` package.

## List of Topic Mapping Modules

There is currently one Topic Mapping module:
- ***BubbleMap*** (`BubbleMap.java` class), which generate bubble maps data, note that this layout method is
developed in JavaScript, hence requires [NodeJS](https://nodejs.org/en/). 

## Specifications

The Topic Mapping module entry in the project file should have the following structure:
```json5
{...
  "mapTopics": {
    "mainTopics": "path",
    "subTopics": "path",
    "mainOutput": "path",
    "subOutput": "path",
    "mapType": "bubble",
    ...
  },
...}
``` 

Where:
- `mainTopics` is the path to the main topics JSON file generated by the
[Topic Clustering module](TopicClusteringModule.md);
- `subTopics` is the path to the sub topics JSON file generated by the
[Topic Clustering module](TopicClusteringModule.md), it is optional and won't map sub topics if not specified;
- `mainOutput` is the path to the main map JSON file to output;
- `subOutput` is the path to the sub maps JSON file to output, it is only necessary when `subTopics` is specified;
- `mapType` defines which map module to use, there is currently one map module supported: `bubble`.

### Bubble Map Specification

If you are setting the `mapType` to `bubble`, here are the additional specifications available:
```json5
{...
  "mapTopics": {
    ...
    "bubbleSize": "-",
    "bubbleScale": [5, 40],
    "nodeCommand": "node"
  },
...}
```

- `bubbleSize` lets you define which distribution total (added to the topic JSON data by the
[Topic Distribution module](TopicDistributionModule.md)) to use for the bubble sizes, a distribution total is
identified by string build along the `fieldName-valueField` structure (`fieldName` and `valueField` are defined
in the distribution specifications), it is optional and defaults to `"-"`, meaning no `fieldName` and `valueField`
specified;
- `bubbleScale` lets you customise the lower and upper boundaries of the bubble size scale, it is optional and defaults
to `[5,40]` meaning 5 pixels minimum radius (size 1 in the data) and 40 pixels maximum radius (maximum size in the 
data);
- `nodeCommand` lets you adjust the command used to invoke NodeJS: by default the command `node` will be used, but some
system have NodeJS linked to the command `nodejs`.

## Output

### Bubble Map Output

Used on the main topics, the Topic Mapping module generates a main map JSON file with the following structure:
```json5
{
  "topics": [{
    "topicId": "0",
    "clusterId": "1",
    "size": 150,
    "labels": [{
      "weight": 165,
      "label": "laser"
    }, ... ],
    "bubbleMap": {
      "r": 26.0,
      "cx": 571.0,
      "cy": 526.0
    }
  }, ... ],
  "bubbleMapBorder": [{
    "d": "M7.1,-27.1A28.0,28.0,0,1,1,-26.6,-8.8A28.0,28.0,0,1,0,7.1,-27.1Z",
    "transform": "translate(571.2,526.9)",
    "strokeWidth": 1
  }, ... ]
}
```
`topics` contains the list of all topics to map:
- `topicId` identifies the topic;
- `clusterId` identifies the cluster in which the topic belongs;
- `size` represent the importance of the topic, as computed by the
[Topic Distribution module](TopicDistributionModule.md);
- `labels` is the list of labels for the topic, each having a `label` and `weight`;
- `bubbleMap` contains the mapping information for the topic, `cx` and `cy` being the x and y coordinate of the 
bubble center, and `r` the buble radius.

`bubbleMapBorder` contains the mapping detail for the borders to draw around bubbles of the same cluster:
- `d` is the border path;
- `transform` contains the transformation to apply to the border to position it around the right bubbles;
- `strokeWidth` is the thickness of the border, usually set to 1 pixel.

Used on the sub topics, the Topic Mapping module produces a set of map data into one JSON file:
```json5
[{
  "subMap": {
    "topics": [ ... ],
    "bubbleMapBorder": [ ... ]
  },
  "mainTopicId": "0"
}, ... ]
```
With:
- `subMap` containing the map data of the sub topics;
- `mainTopicId` referencing the main topic to which the sub map is assigned to. 

---

[< Previous](TopicDistributionModule.md) | [Index](index.md) <!-- | [Next >]() -->

---
This work is licensed under a [Creative Commons Attribution 4.0 International
License][cc-by-nc].

[![CC BY-NC 4.0][cc-by-nc-image]][cc-by-nc]

[cc-by-nc]: http://creativecommons.org/licenses/by-nc/4.0/
[cc-by-nc-image]: https://i.creativecommons.org/l/by-nc/4.0/88x31.png
[cc-by-nc-shield]: https://img.shields.io/badge/License-CC%20BY--NC%204.0-lightgrey.svg
