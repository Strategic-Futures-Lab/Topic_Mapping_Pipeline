# Topic Mapping Pipeline - 2020 [![CC BY-NC 4.0][cc-by-nc-shield]][cc-by-nc]
# Lemmatise Module

The Lemmatise module is the second module of the Topic Mapping pipeline. It *cleans* the corpus and produce lemmatised
text data for the topic modelling process. This data is saved in a ***Lemma JSON file***.

The Lemmatise module is contained in the `P2_Lemmatise` package, in the `Lemmatise.java` class.

## Specifications

The Lemmatise module entry in the project file should have the following structure:
```json5
{...
  "lemmatise": {
    "corpus": "path",
    "textFields": ["key", ...],
    "docFields": ["key", ...],
    "stopWords": ["word", ...],
    "stopPhrases": ["many words", ...],
    "minLemmas": 1,
    "removeLowCounts": 0,
    "output": "path"
  },
...}
``` 

Where:
- `corpus` is the path to the corpus JSON file (generated by an [input module](InputModule.md));
- `output` is the path to the output lemma JSON file;
- `textFields` lists, in the `docData` object of each document, which attributes will constitute the text (i.e., to be 
  lemmatised);
- `docFields` lists, in the `docData` object of each document, which attributes should be kept after the lemmatisation 
  process (e.g., to be analysed later on, or to be printed on an interface, etc.). This list is optional and is set to 
  empty (`[]`) by default. This list gets overwritten by the `docFields` metaparameter (if set);
- `stopPhrases` lists the series of words in the document texts that should be removed (before lemmatisation), e.g., 
  if these phrases are over-represented in the corpus. This list is optional and is set to empty (`[]`) by default;
- `stopWords` lists the labels that should be removed from the documents (after lemmatisation), e.g., if these labels are 
  too generic. This list is optional and is set to empty (`[]`) by default;
- `minLemma` is the minimum number of lemmas a document should have to be kept for the modelling process, i.e.,
  documents with too few words are removed. This number is optional and is set to `1` by default;
- **PROTOTYPE**: `removeLowCounts` is the mininum number of times a lemma should be counted in the total vocabulary, if the 
  count is below this value, the lemma is removed from document's list of lemmas. This number is optional and is set
  to `0` by default. Using this parameter can remove a large amount of information.

## Output

The Lemmatise module generates a lemma JSON file which follow a similar structure to the corpus file:
```json5
{
  "metadata":{
    "nDocsTooShort": 5,
    "minDocSize": 10,
    "totalDocs": 1000,
    "stopWords":"",
    "stopPhrases": "",
    "nLemmasRemoved": 3,
    "minLemmaCount": 1
  },
  "lemmas":[
    {
      "docId": "0",
      "docIndex": 0,
      "lemmas": "lemma1 lemma2 ...",
      "numLemmas": 100,
      "docData": {"key": "value1", ...}
    },{
      "docId": "1",
      "docIndex": 1,
      "tooShort": true,
      "lemmas": "lemma4 lemma5",
      "numLemmas": 2,
      "docData": {"key": "value2", ...}
    }, ...
  ]
}
```

In addition to the number of documents (`totalDocs`), the `metadata` now also contains:
- the number of documents removed for being too small (`nDocsTooShort`);
- the minimum number of lemmas a document should have to be kept (`minDocSize`);
- the list of stop words (`stopWords`);
- the list of stop phrases (`stopPhrases`);
- if `removeLowCounts` was set above `0` in the specifications:
  - the minimum number of times a lemma should be present in the vocabulary (`minLemmaCount`);
  - the number of lemmas removed from the vocabulary (`nLemmasRemoved`).

Then the file has a `lemmas` list, with one object per document with the following information:
- `docId` the document id;
- `docIndex` the document index;
- `lemmas` the string containing the lemmatised text for that document;
- `numLemmas` the number of lemmas in that document;
- `docData` the document data that was kept with `docFields`;
- if the document was too short (as per the setting of `minLemma` in the specifications), the documents is
  flagged as such with a boolean (`tooShort`).

---

[< Previous](InputModule.md) | [Index](index.md) | [Next >](ModelModule.md)

---
This work is licensed under a [Creative Commons Attribution 4.0 International
License][cc-by-nc].

[![CC BY-NC 4.0][cc-by-nc-image]][cc-by-nc]

[cc-by-nc]: http://creativecommons.org/licenses/by-nc/4.0/
[cc-by-nc-image]: https://i.creativecommons.org/l/by-nc/4.0/88x31.png
[cc-by-nc-shield]: https://img.shields.io/badge/License-CC%20BY--NC%204.0-lightgrey.svg
